'use strict';const _0x49d7b9=_0xc862;(function(_0x128cc4,_0xf81b6b){const _0x398ba6=_0xc862,_0x56b46f=_0x128cc4();while(!![]){try{const _0x30ac26=-parseInt(_0x398ba6(0xf3))/0x1+-parseInt(_0x398ba6(0x129))/0x2*(-parseInt(_0x398ba6(0x138))/0x3)+parseInt(_0x398ba6(0x146))/0x4+parseInt(_0x398ba6(0xf2))/0x5*(parseInt(_0x398ba6(0x102))/0x6)+parseInt(_0x398ba6(0x141))/0x7+-parseInt(_0x398ba6(0x10f))/0x8*(-parseInt(_0x398ba6(0xec))/0x9)+parseInt(_0x398ba6(0x113))/0xa*(-parseInt(_0x398ba6(0x126))/0xb);if(_0x30ac26===_0xf81b6b)break;else _0x56b46f['push'](_0x56b46f['shift']());}catch(_0x50ca11){_0x56b46f['push'](_0x56b46f['shift']());}}}(_0x5156,0xa6f0b));function _0x5156(){const _0x17d37b=['&grant_type=authorization_code','user','getUserOpenId','wechatOfficialAppId','18777cgHiLC','function','wechatOfficialAppSecret','18226ZMvkTZ','createHash','get','genXmlMsgByConfig','HttpException','getQRCodeTicket','__metadata','getWechatAccessToken','getOwnPropertyDescriptor','object','HttpStatus','toFixed','sha1','OfficialService','update','39DKJIZV','getQRSceneStr','../../common/utils','log','./../autoreply/autoreply.service','loginByOpenId','userService','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','hex','6023332gFeqsq','authService','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','autoreplyService','scan','2462980qoEfRV','metadata','digest','./../auth/auth.service','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','&redirect_uri=','createRandomNonceStr','axios','sceneStrMap','AuthService','wechatJsapiTicket','wechatAccessToken','getTime','144900ZDNadV',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','getUserById','genXmlMsg','./../user/user.service','bindWx','100SpKVxC','520219rbevqX','__decorate','fetchQRCodeTicket','getConfigs','default','GlobalConfigService','join','length','onModuleInit','str:\x20','&secret=',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','Injectable','&code=','loginByCode','61602FjuZge','jsapiTicket:\x20','verify','tousername','defineProperty','getQRSceneStrByBind','非法参数','jiangly','aotoPlay','jsapi_ticket=','design:paramtypes','&url=','BAD_REQUEST','664NKpVsa','globalConfigService','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','getUserFromOpenId','11320osIbMw','split','UserService','crypto','officialAutoReplyText','&noncestr=','@nestjs/common','__esModule','AutoreplyService','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','回跳跳转地址:\x20','scanedSceneStrMap','decorate','getRedirectUrl','sort'];_0x5156=function(){return _0x17d37b;};return _0x5156();}function _0xc862(_0x1505a2,_0x311d0f){const _0x5156db=_0x5156();return _0xc862=function(_0xc862d,_0x452a20){_0xc862d=_0xc862d-0xea;let _0x46e215=_0x5156db[_0xc862d];return _0x46e215;},_0xc862(_0x1505a2,_0x311d0f);}var __decorate=this&&this[_0x49d7b9(0xf4)]||function(_0x454980,_0x34ada4,_0x1337d6,_0x472028){const _0x3ccfdf=_0x49d7b9;var _0x1f7ee7=arguments[_0x3ccfdf(0xfa)],_0x87f13=_0x1f7ee7<0x3?_0x34ada4:_0x472028===null?_0x472028=Object[_0x3ccfdf(0x131)](_0x34ada4,_0x1337d6):_0x472028,_0x3cc4f8;if(typeof Reflect===_0x3ccfdf(0x132)&&typeof Reflect[_0x3ccfdf(0x11f)]==='function')_0x87f13=Reflect['decorate'](_0x454980,_0x34ada4,_0x1337d6,_0x472028);else{for(var _0x23702a=_0x454980[_0x3ccfdf(0xfa)]-0x1;_0x23702a>=0x0;_0x23702a--)if(_0x3cc4f8=_0x454980[_0x23702a])_0x87f13=(_0x1f7ee7<0x3?_0x3cc4f8(_0x87f13):_0x1f7ee7>0x3?_0x3cc4f8(_0x34ada4,_0x1337d6,_0x87f13):_0x3cc4f8(_0x34ada4,_0x1337d6))||_0x87f13;}return _0x1f7ee7>0x3&&_0x87f13&&Object[_0x3ccfdf(0x106)](_0x34ada4,_0x1337d6,_0x87f13),_0x87f13;},__metadata=this&&this[_0x49d7b9(0x12f)]||function(_0x189acc,_0x498ffc){const _0x3a4117=_0x49d7b9;if(typeof Reflect===_0x3a4117(0x132)&&typeof Reflect[_0x3a4117(0x147)]===_0x3a4117(0x127))return Reflect[_0x3a4117(0x147)](_0x189acc,_0x498ffc);};Object[_0x49d7b9(0x106)](exports,_0x49d7b9(0x11a),{'value':!![]}),exports['OfficialService']=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),auth_service_1=require(_0x49d7b9(0x149)),user_service_1=require(_0x49d7b9(0xf0)),autoreply_service_1=require(_0x49d7b9(0x13c)),common_1=require(_0x49d7b9(0x119)),crypto=require(_0x49d7b9(0x116)),axios_1=require(_0x49d7b9(0x14d)),utils_1=require(_0x49d7b9(0x13a));let OfficialService=class OfficialService{constructor(_0x166296,_0x4d169d,_0x11ef9c,_0x57e583){const _0x2c32fb=_0x49d7b9;this[_0x2c32fb(0x144)]=_0x166296,this[_0x2c32fb(0x13e)]=_0x4d169d,this[_0x2c32fb(0x142)]=_0x11ef9c,this[_0x2c32fb(0x110)]=_0x57e583,this['sceneStrMap']={},this[_0x2c32fb(0x11e)]={};}async[_0x49d7b9(0xfb)](){const _0x2f6f63=_0x49d7b9;await this[_0x2f6f63(0x110)][_0x2f6f63(0x130)](!![]);}async[_0x49d7b9(0x139)](_0x35df12){const _0x15a2a0=_0x49d7b9,{invitedBy:_0xebb3fb}=_0x35df12;let _0x2262d4=(0x0,utils_1[_0x15a2a0(0x14c)])(0x20);return _0xebb3fb&&(_0x2262d4+=':'+_0xebb3fb),this[_0x15a2a0(0x14e)][_0x2262d4]=!![],_0x2262d4;}async[_0x49d7b9(0x107)](_0x27a56a){const _0x5e2a9a=_0x49d7b9,{id:_0x5d565d}=_0x27a56a[_0x5e2a9a(0x123)],_0x442716=(0x0,utils_1[_0x5e2a9a(0x14c)])(0x20)+'/'+_0x5d565d;return this[_0x5e2a9a(0x14e)][_0x442716]=!![],_0x442716;}async[_0x49d7b9(0x12e)](_0x775bab){const _0x196fe3=_0x49d7b9;return this[_0x196fe3(0xf5)](_0x775bab);}async[_0x49d7b9(0x120)](_0x1c1bdd){const _0x58e7f6=_0x49d7b9,_0x219080=await this[_0x58e7f6(0x110)]['getConfigs'](['wechatOfficialAppId']),_0x56e504=_0x58e7f6(0x14a)+_0x219080+_0x58e7f6(0x14b)+encodeURIComponent(_0x1c1bdd)+_0x58e7f6(0x11c);return console['log'](_0x58e7f6(0x11d),_0x56e504),_0x56e504;}async['getJsapiTicket'](_0x1557d2){const _0x5cfecf=_0x49d7b9,_0x33ae78=(0x0,utils_1[_0x5cfecf(0x14c)])(0x20),_0x2dc378=(Date['now']()/0x3e8)[_0x5cfecf(0x134)](0x0),_0x360305=await this[_0x5cfecf(0x110)][_0x5cfecf(0xf6)]([_0x5cfecf(0x150)]);console['log'](_0x5cfecf(0x103),_0x360305);const _0x41914e=await this[_0x5cfecf(0x110)][_0x5cfecf(0xf6)]([_0x5cfecf(0x125)]);console['log']('appId:\x20',_0x41914e);const _0x315308=_0x5cfecf(0x10b)+_0x360305+_0x5cfecf(0x118)+_0x33ae78+'&timestamp='+_0x2dc378+_0x5cfecf(0x10d)+_0x1557d2;console[_0x5cfecf(0x13b)](_0x5cfecf(0xfc),_0x315308);const _0x13b328=this['sha1'](_0x315308);return{'appId':_0x41914e,'nonceStr':_0x33ae78,'timestamp':_0x2dc378,'signature':_0x13b328};}async[_0x49d7b9(0xf5)](_0x21dec9){const _0x23413f=_0x49d7b9,_0x4346f7=await this['globalConfigService'][_0x23413f(0xf6)]([_0x23413f(0xea)]),_0x55127d={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x21dec9}}},_0x469d99=await axios_1[_0x23413f(0xf7)]['post']('https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token='+_0x4346f7,_0x55127d),{data:{errmsg:_0x45233d,ticket:_0x34d011}}=_0x469d99;if(_0x45233d)throw new common_1[(_0x23413f(0x12d))](_0x45233d,common_1[_0x23413f(0x133)][_0x23413f(0x10e)]);return _0x34d011;}async[_0x49d7b9(0x101)](_0xbe5de0,_0x43907f){const _0x1476c9=_0x49d7b9,_0x3208a3=await this[_0x1476c9(0x110)]['getConfigs']([_0x1476c9(0x125)]),_0x231ade=await this[_0x1476c9(0x110)]['getConfigs']([_0x1476c9(0x128)]),_0x73d815=await axios_1[_0x1476c9(0xf7)][_0x1476c9(0x12b)](_0x1476c9(0x143)+_0x3208a3+_0x1476c9(0xfd)+_0x231ade+_0x1476c9(0x100)+_0x43907f+_0x1476c9(0x122)),{data:{errmsg:_0x16c2e0,openid:_0x52ca2e}}=_0x73d815;if(_0x16c2e0)throw new common_1[(_0x1476c9(0x12d))](_0x16c2e0,common_1[_0x1476c9(0x133)][_0x1476c9(0x10e)]);let _0x2e5698;return _0x2e5698=await this[_0x1476c9(0x13e)][_0x1476c9(0x124)](_0x52ca2e),!_0x2e5698&&(_0x2e5698=await this[_0x1476c9(0x13e)][_0x1476c9(0x112)](_0x52ca2e)),this[_0x1476c9(0x142)][_0x1476c9(0x13d)](_0x2e5698,_0xbe5de0);}async[_0x49d7b9(0x145)](_0x473e9d,_0x9319cf){const _0x4cddea=_0x49d7b9;if(!this['sceneStrMap'][_0x9319cf])throw new common_1['HttpException'](_0x4cddea(0x108),common_1[_0x4cddea(0x133)][_0x4cddea(0x10e)]);const _0x49136d=await this[_0x4cddea(0x13e)]['getUserFromOpenId'](_0x473e9d,_0x9319cf);this['scanedSceneStrMap'][_0x9319cf]=_0x49136d['id'];}async['loginBySceneStr'](_0x164a5f,_0x483bc1){const _0x371398=_0x49d7b9;if(!this[_0x371398(0x14e)][_0x483bc1])return;const _0x220548=this[_0x371398(0x11e)][_0x483bc1];if(!_0x220548)return'';const _0xfaecd1=await this[_0x371398(0x13e)][_0x371398(0xee)](_0x220548);return delete this[_0x371398(0x11e)][_0x483bc1],this['authService'][_0x371398(0x13d)](_0xfaecd1,_0x164a5f);}async['scanBindWx'](_0x5f0102,_0x5bc9d9){const _0x7eb8c3=_0x49d7b9;if(!this[_0x7eb8c3(0x14e)][_0x5bc9d9])throw new common_1[(_0x7eb8c3(0x12d))](_0x7eb8c3(0x108),common_1[_0x7eb8c3(0x133)][_0x7eb8c3(0x10e)]);const _0x2bb5db=_0x5bc9d9[_0x7eb8c3(0x114)]('/')[0x1],_0x5f4622=await this['userService'][_0x7eb8c3(0xf1)](_0x5f0102,_0x2bb5db);this[_0x7eb8c3(0x11e)][_0x5bc9d9]=_0x5f4622;}async['bindWxBySceneStr'](_0x5231ac,_0x315f2f){const _0x860ea1=_0x49d7b9;if(!this['sceneStrMap'][_0x315f2f])throw new common_1[(_0x860ea1(0x12d))]('非法参数',common_1[_0x860ea1(0x133)][_0x860ea1(0x10e)]);const {id:_0x641860}=_0x5231ac[_0x860ea1(0x123)],_0x258e99=this[_0x860ea1(0x11e)][_0x315f2f];if(!_0x258e99)return'';return delete this[_0x860ea1(0x11e)][_0x315f2f],_0x258e99;}async[_0x49d7b9(0x104)](_0x48e158,_0x395d69,_0x44ac12){const _0x5208cc=_0x49d7b9,_0x1bf613=await this['globalConfigService'][_0x5208cc(0xf6)](['wechatOfficialToken'])||_0x5208cc(0x109);return await this[_0x5208cc(0x135)]([_0x1bf613,_0x395d69,_0x44ac12][_0x5208cc(0x121)]()[_0x5208cc(0xf9)](''))==_0x48e158;}[_0x49d7b9(0x135)](_0x3d6bee){const _0x186dd5=_0x49d7b9;return crypto[_0x186dd5(0x12a)](_0x186dd5(0x135))[_0x186dd5(0x137)](_0x3d6bee)[_0x186dd5(0x148)](_0x186dd5(0x140));}async[_0x49d7b9(0x12c)](_0x31fbb2,_0x1dc53a){const _0x1444c7=_0x49d7b9,_0x16b8a6=await this['globalConfigService'][_0x1444c7(0xf6)]([_0x1dc53a]);return this[_0x1444c7(0xef)](_0x31fbb2,_0x16b8a6);}async[_0x49d7b9(0xef)](_0x658f77,_0x282e70){const _0x4296a7=_0x49d7b9;return _0x4296a7(0x13f)+_0x658f77['fromusername'][0x0]+_0x4296a7(0xed)+_0x658f77[_0x4296a7(0x105)][0x0]+_0x4296a7(0xfe)+new Date()[_0x4296a7(0xeb)]()+_0x4296a7(0x111)+_0x282e70+']]></Content>\x0a\x20\x20\x20\x20</xml>';}async[_0x49d7b9(0x10a)](_0x9f6c71){const _0x57ad51=_0x49d7b9;let _0x3ae37b=await this[_0x57ad51(0x144)]['checkAutoReply'](_0x9f6c71);if(!_0x3ae37b){const _0x25ec91=await this[_0x57ad51(0x110)][_0x57ad51(0xf6)]([_0x57ad51(0x117)]);_0x3ae37b=_0x25ec91;}return _0x3ae37b;}};OfficialService=__decorate([(0x0,common_1[_0x49d7b9(0xff)])(),__metadata(_0x49d7b9(0x10c),[autoreply_service_1[_0x49d7b9(0x11b)],user_service_1[_0x49d7b9(0x115)],auth_service_1[_0x49d7b9(0x14f)],globalConfig_service_1[_0x49d7b9(0xf8)]])],OfficialService),exports[_0x49d7b9(0x136)]=OfficialService;