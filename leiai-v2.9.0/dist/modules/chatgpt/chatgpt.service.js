'use strict';const _0x4f7dfb=_0x48ec;(function(_0x42a2b8,_0x3c4e7f){const _0x3a81e8=_0x48ec,_0xcd5b2b=_0x42a2b8();while(!![]){try{const _0x4b4c76=parseInt(_0x3a81e8(0x2cc))/0x1*(parseInt(_0x3a81e8(0x2e3))/0x2)+parseInt(_0x3a81e8(0x2c0))/0x3*(-parseInt(_0x3a81e8(0x241))/0x4)+parseInt(_0x3a81e8(0x1f1))/0x5*(-parseInt(_0x3a81e8(0x2d1))/0x6)+parseInt(_0x3a81e8(0x240))/0x7*(parseInt(_0x3a81e8(0x303))/0x8)+parseInt(_0x3a81e8(0x2b4))/0x9*(-parseInt(_0x3a81e8(0x263))/0xa)+parseInt(_0x3a81e8(0x2e2))/0xb+parseInt(_0x3a81e8(0x269))/0xc;if(_0x4b4c76===_0x3c4e7f)break;else _0xcd5b2b['push'](_0xcd5b2b['shift']());}catch(_0x194a51){_0xcd5b2b['push'](_0xcd5b2b['shift']());}}}(_0x22b7,0x8b6fd));var __decorate=this&&this[_0x4f7dfb(0x2cb)]||function(_0x46a539,_0x2a945d,_0x5b065f,_0x3a179c){const _0x5c1545=_0x4f7dfb;var _0x130551=arguments[_0x5c1545(0x2d4)],_0x215054=_0x130551<0x3?_0x2a945d:_0x3a179c===null?_0x3a179c=Object[_0x5c1545(0x273)](_0x2a945d,_0x5b065f):_0x3a179c,_0x5e7393;if(typeof Reflect==='object'&&typeof Reflect[_0x5c1545(0x283)]===_0x5c1545(0x25a))_0x215054=Reflect[_0x5c1545(0x283)](_0x46a539,_0x2a945d,_0x5b065f,_0x3a179c);else{for(var _0x425a6e=_0x46a539[_0x5c1545(0x2d4)]-0x1;_0x425a6e>=0x0;_0x425a6e--)if(_0x5e7393=_0x46a539[_0x425a6e])_0x215054=(_0x130551<0x3?_0x5e7393(_0x215054):_0x130551>0x3?_0x5e7393(_0x2a945d,_0x5b065f,_0x215054):_0x5e7393(_0x2a945d,_0x5b065f))||_0x215054;}return _0x130551>0x3&&_0x215054&&Object[_0x5c1545(0x1e2)](_0x2a945d,_0x5b065f,_0x215054),_0x215054;},__metadata=this&&this[_0x4f7dfb(0x213)]||function(_0x5017a4,_0x381530){const _0x565b97=_0x4f7dfb;if(typeof Reflect===_0x565b97(0x2fc)&&typeof Reflect[_0x565b97(0x2c6)]===_0x565b97(0x25a))return Reflect[_0x565b97(0x2c6)](_0x5017a4,_0x381530);},__param=this&&this['__param']||function(_0x282d5c,_0x368de2){return function(_0x301cfa,_0x5ab8ea){_0x368de2(_0x301cfa,_0x5ab8ea,_0x282d5c);};};Object['defineProperty'](exports,_0x4f7dfb(0x233),{'value':!![]}),exports[_0x4f7dfb(0x311)]=void 0x0;const upload_service_1=require('./../upload/upload.service'),user_service_1=require(_0x4f7dfb(0x1d6)),nestjs_config_1=require(_0x4f7dfb(0x29f)),common_1=require('@nestjs/common'),errorMessage_constant_1=require(_0x4f7dfb(0x2a6)),utils_1=require(_0x4f7dfb(0x318)),axios_1=require(_0x4f7dfb(0x2a7)),userBalance_service_1=require('../userBalance/userBalance.service'),balance_constant_1=require(_0x4f7dfb(0x271)),chatLog_service_1=require(_0x4f7dfb(0x224)),uuid=require(_0x4f7dfb(0x295)),config_entity_1=require(_0x4f7dfb(0x2cf)),typeorm_1=require(_0x4f7dfb(0x215)),typeorm_2=require(_0x4f7dfb(0x2be)),badwords_service_1=require('../badwords/badwords.service'),autoreply_service_1=require(_0x4f7dfb(0x25c)),gptKeys_entity_1=require(_0x4f7dfb(0x2c9)),globalConfig_service_1=require(_0x4f7dfb(0x237)),whiteList_entity_1=require('./whiteList.entity'),user_entity_1=require(_0x4f7dfb(0x296)),fanyi_service_1=require(_0x4f7dfb(0x2da)),dayjs=require(_0x4f7dfb(0x2e4)),app_entity_1=require(_0x4f7dfb(0x2d8)),JWT=require(_0x4f7dfb(0x304));let ChatgptService=class ChatgptService{constructor(_0x2c7852,_0x384af4,_0x377164,_0x2cd671,_0x1e2bf8,_0x3e0b0d,_0x3a576a,_0x271657,_0x23fdde,_0x5d5bb5,_0x1de9b8,_0x8d44a9,_0x1f60e4,_0x1132bc){const _0x441449=_0x4f7dfb;this[_0x441449(0x251)]=_0x2c7852,this[_0x441449(0x1e4)]=_0x384af4,this[_0x441449(0x272)]=_0x377164,this[_0x441449(0x28a)]=_0x2cd671,this[_0x441449(0x201)]=_0x1e2bf8,this[_0x441449(0x1d4)]=_0x3e0b0d,this[_0x441449(0x1e9)]=_0x3a576a,this['chatLogService']=_0x271657,this[_0x441449(0x284)]=_0x23fdde,this[_0x441449(0x260)]=_0x5d5bb5,this[_0x441449(0x20a)]=_0x1de9b8,this['autoreplyService']=_0x8d44a9,this[_0x441449(0x2f9)]=_0x1f60e4,this['fanyiService']=_0x1132bc,this[_0x441449(0x1fd)]=[],this[_0x441449(0x2d2)]={'list1':[],'list2':[],'list3':[],'list4':[],'list6':[],'list7':[],'list8':[]},this['defaultBase']=_0x441449(0x1eb);}async[_0x4f7dfb(0x2b3)](){const _0x166b36=_0x4f7dfb;await this['getAllKeyList']();let _0x3443e3=await(0x0,utils_1[_0x166b36(0x2ad)])('@leikeduntech/leiai-js'),_0xcb5cc9=await(0x0,utils_1[_0x166b36(0x2ad)])(_0x166b36(0x22c)),_0x32a388=await(0x0,utils_1[_0x166b36(0x2ad)])(_0x166b36(0x317));_0x3443e3=(_0x3443e3===null||_0x3443e3===void 0x0?void 0x0:_0x3443e3['default'])?_0x3443e3['default']:_0x3443e3,_0xcb5cc9=(_0xcb5cc9===null||_0xcb5cc9===void 0x0?void 0x0:_0xcb5cc9['default'])?_0xcb5cc9[_0x166b36(0x2e5)]:_0xcb5cc9,_0x32a388=(_0x32a388===null||_0x32a388===void 0x0?void 0x0:_0x32a388[_0x166b36(0x2e5)])?_0x32a388[_0x166b36(0x2e5)]:_0x32a388;const {ChatGPTAPI:_0x1fb114,ChatGPTError:_0x5ae673,ChatGPTUnofficialProxyAPI:_0x58c73e}=_0x3443e3,_0x1aa4fc=+process[_0x166b36(0x1fe)][_0x166b36(0x27d)],_0x69a126=process[_0x166b36(0x1fe)][_0x166b36(0x27c)],_0x2aafda=process[_0x166b36(0x1fe)][_0x166b36(0x219)],_0x1e80f8=process[_0x166b36(0x1fe)][_0x166b36(0x302)],_0x46cc04='redis://'+(_0x1e80f8||'')+':'+(_0x2aafda||'')+'@'+_0x69a126+':'+_0x1aa4fc,_0x2230ed=new _0xcb5cc9(_0x46cc04),_0x3a96a6=new _0x32a388({'store':_0x2230ed,'namespace':_0x166b36(0x27e)});if(!this[_0x166b36(0x23c)])this[_0x166b36(0x23c)]=new _0x32a388({'store':_0x2230ed,'namespace':_0x166b36(0x290)});if(!this[_0x166b36(0x309)])this[_0x166b36(0x309)]=new _0x32a388({'store':_0x2230ed,'namespace':'leiai-zhipu'});this[_0x166b36(0x298)]=new _0x1fb114({'apiKey':_0x166b36(0x2ba),'apiBaseUrl':this[_0x166b36(0x2ee)]+_0x166b36(0x26b),'messageStore':_0x3a96a6});}async[_0x4f7dfb(0x235)](_0x4033e6){const _0x3b1da4=_0x4f7dfb,{list1:_0x3b5f82,list2:_0x22da01,list3:_0x3a9d77,list4:_0x279307,list6:_0x149510,list7:_0x1e3341,list8:_0x52b59a}=this[_0x3b1da4(0x2d2)];if(_0x3b5f82[_0x3b1da4(0x2d4)]===0x0&&_0x22da01[_0x3b1da4(0x2d4)]===0x0&&_0x3a9d77[_0x3b1da4(0x2d4)]===0x0&&_0x279307[_0x3b1da4(0x2d4)]===0x0&&_0x149510[_0x3b1da4(0x2d4)]===0x0&&_0x1e3341[_0x3b1da4(0x2d4)]===0x0&&_0x52b59a[_0x3b1da4(0x2d4)]===0x0)throw new common_1['HttpException'](_0x3b1da4(0x2a4),common_1[_0x3b1da4(0x218)]['BAD_REQUEST']);if(_0x4033e6===0x1){if(_0x3b5f82['length']===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x238),common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);return(0x0,utils_1['selectKeyWithWeight'])(_0x3b5f82);}if(_0x4033e6===0x2){if(_0x22da01[_0x3b1da4(0x2d4)]===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x2ff),common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);return(0x0,utils_1['selectKeyWithWeight'])(_0x22da01);}if(_0x4033e6===0x3){if(_0x3a9d77[_0x3b1da4(0x2d4)]===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x228),common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);return(0x0,utils_1['selectKeyWithWeight'])(_0x3a9d77);}if(_0x4033e6===0x6){if(_0x149510[_0x3b1da4(0x2d4)]===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x279),common_1[_0x3b1da4(0x218)]['BAD_REQUEST']);return(0x0,utils_1[_0x3b1da4(0x24a)])(_0x149510);}if(_0x4033e6===0x7){if(_0x1e3341['length']===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x287),common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);return(0x0,utils_1[_0x3b1da4(0x24a)])(_0x1e3341);}if(_0x4033e6===0x8){if(_0x52b59a[_0x3b1da4(0x2d4)]===0x0)throw new common_1[(_0x3b1da4(0x256))](_0x3b1da4(0x1db),common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);return(0x0,utils_1[_0x3b1da4(0x24a)])(_0x52b59a);}if(_0x4033e6===0x4){if(_0x279307['length']===0x0){const _0x1ad17e=await this[_0x3b1da4(0x2f9)][_0x3b1da4(0x2aa)]([_0x3b1da4(0x29c)]);if(Number(_0x1ad17e)!==0x1)throw new common_1[(_0x3b1da4(0x256))]('未配置[卡池4]的有效key、请先前往后台系统配置！',common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);common_1[_0x3b1da4(0x27f)]['error'](_0x3b1da4(0x28c));if(_0x3a9d77[_0x3b1da4(0x2d4)]===0x0)throw new common_1[(_0x3b1da4(0x256))]('未配置有效key、请先前往后台系统配置！',common_1[_0x3b1da4(0x218)][_0x3b1da4(0x301)]);else return(0x0,utils_1['selectKeyWithWeight'])(_0x3a9d77);}else return(0x0,utils_1[_0x3b1da4(0x24a)])(_0x279307);}}async['getGptParams'](_0x2c8d7a,_0x525b71,_0x1f7472){const _0x2a8a6c=_0x4f7dfb,{parentMessageId:parentMessageId=0x0,temperature:temperature=0.95,top_p:_0x417f86,model:_0x3da868=0x1}=_0x525b71,_0x1615d9=await this[_0x2a8a6c(0x27b)](_0x2c8d7a,_0x3da868),{openaiTimeoutMs:_0x19e13c}=_0x1615d9,_0x2adecc=await this[_0x2a8a6c(0x2f9)][_0x2a8a6c(0x2aa)]([_0x2a8a6c(0x29b)]),_0x48c546=_0x19e13c||_0x2adecc||0x64*0x3e8,{manufacturer:_0x5be442,model:_0x3dbfea,key:_0x28d34d}=_0x1615d9,_0x1e3338={'parentMessageId':parentMessageId,'timeoutMs':+_0x48c546,'completionParams':{'model':_0x3dbfea,'temperature':temperature}};if([_0x2a8a6c(0x28f),_0x2a8a6c(0x26e)]['indexOf'](_0x5be442[_0x2a8a6c(0x276)]())>-0x1)_0x1f7472&&(_0x1e3338[_0x2a8a6c(0x24d)]=_0x1f7472);return{'options':_0x1e3338,'detailKeyInfo':_0x1615d9};}async[_0x4f7dfb(0x1cf)](_0x281286,_0x48c474){const _0x586b0b=_0x4f7dfb,_0x43aeb6=this[_0x586b0b(0x23c)];let _0x5c1c5d=await _0x43aeb6[_0x586b0b(0x1f7)](_0x586b0b(0x1f2));if(_0x5c1c5d){_0x5c1c5d=JSON[_0x586b0b(0x2a2)](_0x5c1c5d);if(Math[_0x586b0b(0x275)](new Date()[_0x586b0b(0x2e1)]()/0x3e8)-_0x5c1c5d['createDate']<_0x5c1c5d[_0x586b0b(0x2b8)])return console[_0x586b0b(0x20b)]('getBaiduAccessToken\x20success\x20from\x20cache:\x20',_0x5c1c5d),_0x5c1c5d[_0x586b0b(0x1e6)];}let _0xbaead4='https://aip.baidubce.com/oauth/2.0/token?client_id='+_0x281286+_0x586b0b(0x217)+_0x48c474+_0x586b0b(0x2ca),_0x134b38={'method':'post','url':_0xbaead4,'headers':{'Content-Type':_0x586b0b(0x203)},'timeout':0x1388};return await(0x0,axios_1[_0x586b0b(0x2e5)])(_0x134b38)[_0x586b0b(0x2e0)](function(_0x161789){const _0x2a8370=_0x586b0b,_0x3ab657=Object[_0x2a8370(0x2db)](Object[_0x2a8370(0x2db)]({},_0x161789[_0x2a8370(0x2fb)]),{'createDate':Math[_0x2a8370(0x275)](new Date()['getTime']()/0x3e8)-0x3c});return console['log'](_0x2a8370(0x2bc),_0x3ab657),_0x43aeb6[_0x2a8370(0x1e0)](_0x2a8370(0x1f2),JSON['stringify'](_0x3ab657)),_0x3ab657===null||_0x3ab657===void 0x0?void 0x0:_0x3ab657[_0x2a8370(0x1e6)];})[_0x586b0b(0x2d3)](function(_0x373143){const _0x1c261d=_0x586b0b;var _0x413671,_0x408641,_0x58b3c5,_0x5491d;console[_0x1c261d(0x20b)](_0x1c261d(0x2cd),_0x373143);const _0x9731dc=((_0x413671=_0x373143===null||_0x373143===void 0x0?void 0x0:_0x373143[_0x1c261d(0x2c4)])===null||_0x413671===void 0x0?void 0x0:_0x413671[_0x1c261d(0x2ab)])||0x1f4,_0xb328bc=(_0x5491d=(_0x58b3c5=(_0x408641=_0x373143===null||_0x373143===void 0x0?void 0x0:_0x373143[_0x1c261d(0x2c4)])===null||_0x408641===void 0x0?void 0x0:_0x408641['data'])===null||_0x58b3c5===void 0x0?void 0x0:_0x58b3c5['error'])===null||_0x5491d===void 0x0?void 0x0:_0x5491d[_0x1c261d(0x22f)];throw new common_1['HttpException'](_0xb328bc,_0x9731dc);});}async[_0x4f7dfb(0x253)](_0x154c47){const _0x4eb8d8=_0x4f7dfb,_0x4cfa24=this['zhipuCache'];try{let _0x23ebd4=await _0x4cfa24[_0x4eb8d8(0x1f7)](_0x4eb8d8(0x226));if(typeof _0x23ebd4===_0x4eb8d8(0x1ff)&&_0x23ebd4[_0x4eb8d8(0x2d4)]>0x0&&!!_0x23ebd4){_0x23ebd4=JSON['parse'](_0x23ebd4);if(new Date()[_0x4eb8d8(0x2e1)]()<_0x23ebd4['expireTime'])return console[_0x4eb8d8(0x20b)]('getZhipuToken\x20success\x20from\x20cache:\x20',_0x23ebd4),_0x23ebd4[_0x4eb8d8(0x1e6)];}}catch(_0x58d830){console[_0x4eb8d8(0x20b)]('getZhipuToken\x20error\x20',_0x58d830);}const _0x3bacc3=_0x154c47['split']('.'),_0x5c6bf7=new Date()[_0x4eb8d8(0x2e1)](),_0x31cf93=_0x5c6bf7+0x18*0x3c*0x3c*0x3e8,_0x3dfb9a=JWT[_0x4eb8d8(0x300)]({'api_key':_0x3bacc3[0x0],'exp':_0x31cf93,'timestamp':_0x5c6bf7},_0x3bacc3[0x1],_0x4eb8d8(0x20f),{'header':{'alg':_0x4eb8d8(0x20f),'sign_type':_0x4eb8d8(0x23d)}}),_0x57d271={'access_token':_0x3dfb9a,'createDate':_0x5c6bf7,'expireTime':_0x31cf93};return console['log'](_0x4eb8d8(0x2dc),_0x57d271),this[_0x4eb8d8(0x309)][_0x4eb8d8(0x1e0)](_0x4eb8d8(0x226),JSON[_0x4eb8d8(0x29d)](_0x57d271)),_0x3dfb9a;}async[_0x4f7dfb(0x261)](_0x280533,_0x4fee93,_0x1dcaab){const _0x585871=_0x4f7dfb;var _0x1cf910,_0x4cdbc3,_0x5c5aa2,_0x3333a6,_0x2314e8,_0x5c722c;const _0xdf0bd8=_0x4fee93[_0x585871(0x2ea)],{options:options={},systemMessage:_0x5c6511,appId:_0x4bd210,cusromPrompt:_0x1b4ea0}=_0x280533;if(options[_0x585871(0x2ac)]===0x5)options[_0x585871(0x2ac)]=0x3;let {prompt:_0x2cf511}=_0x280533;const {groupId:_0x3f23e9,temperature:temperature=0.8,usingNetwork:_0x20609c}=options;if(_0x1b4ea0||_0x4bd210){_0x1b4ea0&&(options['model']=0x3);if([0x3,0x4]['indexOf'](options===null||options===void 0x0?void 0x0:options[_0x585871(0x2ac)])>-0x1)options['temperature']=0.8;if(options['parentMessageId'])delete options[_0x585871(0x23a)];}const {model:model=0x3}=options;await this[_0x585871(0x284)][_0x585871(0x1c7)](_0x4fee93['user']['id']),await this[_0x585871(0x1e9)][_0x585871(0x1f5)](_0x4fee93['user']['id'],[0x2,0x4,0x6,0x7,0x8][_0x585871(0x2f7)](options===null||options===void 0x0?void 0x0:options[_0x585871(0x2ac)])>-0x1?_0x585871(0x299):_0x585871(0x286),0x1),_0x1dcaab&&_0x1dcaab[_0x585871(0x2a8)]('Content-type',_0x585871(0x1e8));if(_0x1b4ea0&&await this['badwordsService']['checkBadWords'](_0x2cf511)){const _0x6a338d={'message':_0x585871(0x242),'code':0x1f4};if(_0x1dcaab)return _0x1dcaab[_0x585871(0x2f5)](JSON[_0x585871(0x29d)](_0x6a338d)),_0x1dcaab['end']();else throw new common_1[(_0x585871(0x256))](_0x6a338d[_0x585871(0x22f)],common_1[_0x585871(0x218)][_0x585871(0x301)]);}const _0x2d2242=await this['autoreplyService'][_0x585871(0x247)](_0x2cf511);if(_0x2d2242&&_0x1dcaab){const _0x47ec83={'message':_0x2d2242,'code':0x1f4};return _0x1dcaab[_0x585871(0x2f5)](JSON[_0x585871(0x29d)](_0x47ec83)),_0x1dcaab[_0x585871(0x245)]();}let _0x3f2e3c=_0x5c6511;if(_0x4bd210){const _0xde5582=await this[_0x585871(0x201)][_0x585871(0x229)]({'where':{'id':_0x4bd210,'status':(0x0,typeorm_1['In'])([0x1,0x3,0x4,0x5])}});if(!_0xde5582)throw new common_1[(_0x585871(0x256))]('你当前使用的应用已被下架、请删除当前对话开启新的对话吧！',common_1['HttpStatus'][_0x585871(0x301)]);[0x3,0x4][_0x585871(0x2f7)](model)>-0x1?(_0xde5582[_0x585871(0x259)][_0x585871(0x25b)](_0x585871(0x288))&&(_0xde5582[_0x585871(0x259)]=_0xde5582['preset'][_0x585871(0x211)](/LEIAI_USER_QUESTION_CONTENT/,'')),_0xde5582[_0x585871(0x259)]&&(_0x3f2e3c=_0xde5582[_0x585871(0x259)])):_0xde5582[_0x585871(0x259)]&&(_0xde5582['preset'][_0x585871(0x25b)](_0x585871(0x288))?_0x2cf511=_0xde5582['preset']['replace'](/LEIAI_USER_QUESTION_CONTENT/,_0x2cf511):_0x2cf511=_0xde5582[_0x585871(0x259)]+_0x585871(0x2f2)+_0x2cf511+'\x20');}else{if(_0x1b4ea0)_0x3f2e3c=_0x5c6511;else{const _0x39a11f=new Date()[_0x585871(0x223)]()[_0x585871(0x22a)]('T')[0x0],_0xfd35b8=await this[_0x585871(0x2f9)][_0x585871(0x2aa)]([_0x585871(0x2f8)]);_0x3f2e3c=_0xfd35b8+(_0x585871(0x2c7)+_0x39a11f);}}let _0x19d38a='';if(_0x20609c){_0x19d38a=await(0x0,utils_1['compileNetwork'])(_0x2cf511);const _0x31dcfd=new Date()['toISOString']()[_0x585871(0x22a)]('T')[0x0],_0x1798ce=await this[_0x585871(0x2f9)][_0x585871(0x2aa)](['systemPreMessage']);_0x3f2e3c=_0x1798ce+(_0x585871(0x2c7)+_0x31dcfd);}const _0x462bdf=await this[_0x585871(0x1ef)](_0x4fee93[_0x585871(0x1d3)]['id'],options,_0x3f2e3c),{options:_0xc11e71,detailKeyInfo:_0x5e54db}=_0x462bdf,{key:_0x51b356,secretKey:_0x33056a,maxToken:_0x3e63c4,maxTokenRes:_0x3f7668,proxyUrl:_0x204eb4}=await this[_0x585871(0x310)](_0x5e54db);this[_0x585871(0x298)][_0x585871(0x2b9)]=(0x0,utils_1[_0x585871(0x315)])(_0x51b356),this['api'][_0x585871(0x2bd)]=_0x3e63c4,this[_0x585871(0x298)][_0x585871(0x1da)]=_0x3f7668;switch((_0x1cf910=_0x5e54db===null||_0x5e54db===void 0x0?void 0x0:_0x5e54db[_0x585871(0x1f0)])===null||_0x1cf910===void 0x0?void 0x0:_0x1cf910[_0x585871(0x276)]()){case _0x585871(0x1d9):const _0xaa95ee=await this[_0x585871(0x1cf)](_0x51b356,_0x33056a);this[_0x585871(0x298)][_0x585871(0x1f0)]=_0x585871(0x268);const _0x47fc0d=model===0x1?'completions':_0x585871(0x26c);this[_0x585871(0x298)][_0x585871(0x2f0)]=_0x585871(0x239)+_0x47fc0d+_0x585871(0x2fd)+_0xaa95ee;break;case'azure':this[_0x585871(0x298)]['manufacturer']=_0x585871(0x21f),this[_0x585871(0x298)][_0x585871(0x2f0)]=_0x204eb4+_0x585871(0x262)+_0x5e54db[_0x585871(0x2ac)]+'/chat/completions?api-version=2023-07-01-preview';break;case _0x585871(0x1c9):this['api'][_0x585871(0x1f0)]=_0x585871(0x2ae),this[_0x585871(0x298)][_0x585871(0x2f0)]='https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation?version-id=v1&task-group=aigc&task=text-generation&function-call=generation';break;case _0x585871(0x216):this[_0x585871(0x298)][_0x585871(0x1f0)]=_0x585871(0x216),this[_0x585871(0x298)]['apiBaseUrl']=_0x585871(0x291)+_0x5e54db[_0x585871(0x2ac)]+_0x585871(0x1d8),this['api'][_0x585871(0x2b9)]=await this[_0x585871(0x253)](_0x51b356);break;case'xunfei':this[_0x585871(0x298)][_0x585871(0x1f0)]=_0x585871(0x2e6),this[_0x585871(0x298)][_0x585871(0x2b9)]=_0x51b356+'.'+_0x33056a;break;default:this[_0x585871(0x298)][_0x585871(0x1f0)]=_0x585871(0x306),this['api'][_0x585871(0x2f0)]=this[_0x585871(0x2ee)]+_0x585871(0x26b);if(!!_0x204eb4)this[_0x585871(0x298)][_0x585871(0x2f0)]=_0x204eb4+_0x585871(0x26b);break;}common_1[_0x585871(0x27f)][_0x585871(0x2d7)](_0x585871(0x23e)+this[_0x585871(0x298)]['apiBaseUrl']),common_1['Logger']['debug'](_0x585871(0x1c8)+JSON['stringify'](_0xc11e71)),common_1[_0x585871(0x27f)][_0x585871(0x2d7)](_0x5e54db[_0x585871(0x2ac)]+_0x585871(0x2e7)+_0x4fee93[_0x585871(0x1d3)]['id']+'->\x20maxModelTokens:\x20'+_0x3e63c4+_0x585871(0x249)+_0x3f7668+'\x20',_0x585871(0x311)),_0x1dcaab&&_0x1dcaab[_0x585871(0x2ab)](0xc8);let _0x474876=null;try{if(_0x1dcaab){let _0x2b4427=null,_0x1f8ed1=![];_0x1dcaab['on'](_0x585871(0x1de),async()=>{const _0x440cd=_0x585871;var _0x1bd5a1,_0x299bed,_0xbc1d69,_0x5d251a;if(_0x1f8ed1)return;_0xdf0bd8['abort']();const _0x3d5bbd=await this[_0x440cd(0x298)]['_getTokenCount'](_0x2cf511)||0x0,_0x1ef636=await this[_0x440cd(0x298)][_0x440cd(0x2a1)]((_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x30b)])||''),_0xadb9c6=_0x3d5bbd+_0x1ef636,_0x53eb8a=(0x0,utils_1[_0x440cd(0x258)])(_0x4fee93);await this[_0x440cd(0x255)]['saveChatLog']({'appId':_0x4bd210,'curIp':_0x53eb8a,'userId':_0x4fee93[_0x440cd(0x1d3)]['id'],'type':balance_constant_1['DeductionKey'][_0x440cd(0x208)],'prompt':_0x2cf511,'answer':'','promptTokens':_0x3d5bbd,'completionTokens':0x0,'totalTokens':_0x3d5bbd,'model':((_0x1bd5a1=_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427['detail'])===null||_0x1bd5a1===void 0x0?void 0x0:_0x1bd5a1[_0x440cd(0x2ac)])||_0x5e54db[_0x440cd(0x2ac)],'role':_0x440cd(0x1d3),'groupId':_0x3f23e9,'requestOptions':JSON[_0x440cd(0x29d)]({'options':null,'prompt':_0x2cf511})}),await this[_0x440cd(0x255)]['saveChatLog']({'appId':_0x4bd210,'curIp':_0x53eb8a,'userId':_0x4fee93['user']['id'],'type':balance_constant_1[_0x440cd(0x314)][_0x440cd(0x208)],'prompt':_0x2cf511,'answer':_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x30b)],'promptTokens':_0x3d5bbd,'completionTokens':_0x1ef636,'totalTokens':_0xadb9c6,'model':((_0x299bed=_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x1ed)])===null||_0x299bed===void 0x0?void 0x0:_0x299bed[_0x440cd(0x2ac)])||_0x5e54db['model'],'role':_0x440cd(0x222),'groupId':_0x3f23e9,'requestOptions':JSON[_0x440cd(0x29d)]({'options':{'model':((_0xbc1d69=_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x1ed)])===null||_0xbc1d69===void 0x0?void 0x0:_0xbc1d69[_0x440cd(0x2ac)])||_0x5e54db[_0x440cd(0x2ac)],'temperature':temperature},'prompt':_0x2cf511}),'conversationOptions':JSON[_0x440cd(0x29d)]({'conversationId':_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x2a5)],'model':((_0x5d251a=_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427[_0x440cd(0x1ed)])===null||_0x5d251a===void 0x0?void 0x0:_0x5d251a[_0x440cd(0x2ac)])||_0x5e54db[_0x440cd(0x2ac)],'parentMessageId':_0x2b4427===null||_0x2b4427===void 0x0?void 0x0:_0x2b4427['id'],'temperature':temperature})});let _0x3297f8=0x3;if([0x1,0x2,0x3,0x4,0x6,0x7,0x8]['includes'](model)){_0x3297f8=model;if(model===0x1)_0x3297f8=0x3;if([0x2,0x6,0x7,0x8][_0x440cd(0x2f7)](model)>-0x1)_0x3297f8=0x4;}await this[_0x440cd(0x1e9)]['deductFromBalance'](_0x4fee93['user']['id'],'model'+_0x3297f8,0x1,_0xadb9c6);});let _0x5b4c74=!![];_0x474876=await this['api'][_0x585871(0x267)](_0x20609c?_0x19d38a:_0x2cf511,Object[_0x585871(0x2db)](Object[_0x585871(0x2db)]({},_0xc11e71),{'onProgress':_0x2fe384=>{const _0x2874cc=_0x585871;_0x1dcaab[_0x2874cc(0x2f5)](_0x5b4c74?JSON[_0x2874cc(0x29d)](_0x2fe384):'\x0a'+JSON[_0x2874cc(0x29d)](_0x2fe384)),_0x5b4c74=![],_0x2b4427=_0x2fe384;},'abortSignal':_0xdf0bd8[_0x585871(0x221)]})),_0x1f8ed1=!![];}else _0x474876=await this[_0x585871(0x298)][_0x585871(0x267)](_0x20609c?_0x19d38a:_0x2cf511,_0xc11e71);const {prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=(_0x4cdbc3=_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876[_0x585871(0x1ed)])===null||_0x4cdbc3===void 0x0?void 0x0:_0x4cdbc3['usage'];let _0xfdeb5e=0x3;if([0x1,0x2,0x3,0x4,0x6,0x7,0x8][_0x585871(0x25b)](model)){_0xfdeb5e=model;if(model===0x1)_0xfdeb5e=0x3;if([0x2,0x6,0x7,0x8][_0x585871(0x2f7)](model)>-0x1)_0xfdeb5e=0x4;}await this[_0x585871(0x1e9)]['deductFromBalance'](_0x4fee93[_0x585871(0x1d3)]['id'],_0x585871(0x2ac)+_0xfdeb5e,0x1,total_tokens);const _0x3d448b=(0x0,utils_1['getClientIp'])(_0x4fee93);await this[_0x585871(0x255)][_0x585871(0x21e)]({'appId':_0x4bd210,'curIp':_0x3d448b,'userId':_0x4fee93[_0x585871(0x1d3)]['id'],'type':balance_constant_1['DeductionKey'][_0x585871(0x208)],'prompt':_0x2cf511,'answer':'','promptTokens':prompt_tokens,'completionTokens':0x0,'totalTokens':prompt_tokens,'model':((_0x5c5aa2=_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876[_0x585871(0x1ed)])===null||_0x5c5aa2===void 0x0?void 0x0:_0x5c5aa2['model'])||_0x5e54db[_0x585871(0x2ac)],'role':_0x585871(0x1d3),'groupId':_0x3f23e9,'requestOptions':JSON['stringify']({'options':null,'prompt':_0x2cf511})}),await this[_0x585871(0x255)]['saveChatLog']({'appId':_0x4bd210,'curIp':_0x3d448b,'userId':_0x4fee93['user']['id'],'type':balance_constant_1[_0x585871(0x314)][_0x585871(0x208)],'prompt':_0x2cf511,'answer':_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876[_0x585871(0x30b)],'promptTokens':prompt_tokens,'completionTokens':completion_tokens,'totalTokens':total_tokens,'model':((_0x3333a6=_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876['detail'])===null||_0x3333a6===void 0x0?void 0x0:_0x3333a6['model'])||_0x5e54db[_0x585871(0x2ac)],'role':_0x585871(0x222),'groupId':_0x3f23e9,'requestOptions':JSON[_0x585871(0x29d)]({'options':{'model':((_0x2314e8=_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876[_0x585871(0x1ed)])===null||_0x2314e8===void 0x0?void 0x0:_0x2314e8[_0x585871(0x2ac)])||_0x5e54db['model'],'temperature':temperature},'prompt':_0x2cf511}),'conversationOptions':JSON[_0x585871(0x29d)]({'conversationId':_0x474876[_0x585871(0x2a5)],'model':((_0x5c722c=_0x474876===null||_0x474876===void 0x0?void 0x0:_0x474876[_0x585871(0x1ed)])===null||_0x5c722c===void 0x0?void 0x0:_0x5c722c[_0x585871(0x2ac)])||_0x5e54db[_0x585871(0x2ac)],'parentMessageId':_0x474876['id'],'temperature':temperature})}),common_1['Logger']['debug'](_0x585871(0x1fb)+model+_0x585871(0x246)+_0x51b356+'\x20secreteKey\x20->\x20'+_0x33056a,_0x585871(0x311));const _0x406627=await this[_0x585871(0x1e9)]['queryUserBalance'](_0x4fee93['user']['id']);return _0x474876['detail'][_0x585871(0x30a)]=Object['assign']({},_0x406627),_0x1dcaab?_0x1dcaab['write']('\x0a'+JSON[_0x585871(0x29d)](_0x474876)):_0x474876[_0x585871(0x30b)];}catch(_0x37e4ac){console[_0x585871(0x20b)](_0x5e54db[_0x585871(0x1f0)]+_0x585871(0x1cd),_0x37e4ac);const _0x34137e=_0x37e4ac===null||_0x37e4ac===void 0x0?void 0x0:_0x37e4ac[_0x585871(0x2f3)];if(_0x37e4ac[_0x585871(0x2ab)]&&_0x37e4ac[_0x585871(0x2ab)]===0x192){const _0x2ba34e={'message':_0x37e4ac[_0x585871(0x22f)],'code':0x192};if(_0x1dcaab)return _0x1dcaab[_0x585871(0x2f5)](JSON[_0x585871(0x29d)](_0x2ba34e));else throw new common_1['HttpException'](_0x37e4ac['message'],common_1[_0x585871(0x218)][_0x585871(0x243)]);}if(!_0x34137e){if(_0x1dcaab)return _0x1dcaab['write'](JSON['stringify']({'message':_0x37e4ac[_0x585871(0x22f)],'code':0x1f4}));else throw new common_1[(_0x585871(0x256))](_0x37e4ac[_0x585871(0x22f)],common_1[_0x585871(0x218)][_0x585871(0x301)]);}(_0x37e4ac===null||_0x37e4ac===void 0x0?void 0x0:_0x37e4ac[_0x585871(0x2f3)])===0x1ad&&_0x37e4ac[_0x585871(0x22f)][_0x585871(0x25b)](_0x585871(0x26a))&&await this[_0x585871(0x1d5)](_0x51b356);_0x34137e===0x190&&console['log'](_0x585871(0x1fc),_0x37e4ac,_0x37e4ac[_0x585871(0x22f)]);const _0x46576e=_0x37e4ac['message']||(errorMessage_constant_1[_0x585871(0x22e)][_0x34137e]?errorMessage_constant_1[_0x585871(0x22e)][_0x34137e]:_0x585871(0x2d9)),_0x21051b={'message':_0x46576e||_0x585871(0x26f),'code':_0x34137e===0x191?0x190:_0x34137e||0x1f4};if(_0x1dcaab)return _0x1dcaab[_0x585871(0x2f5)](JSON['stringify'](_0x21051b));else throw new common_1[(_0x585871(0x256))](_0x21051b[_0x585871(0x22f)],common_1[_0x585871(0x218)][_0x585871(0x301)]);}finally{_0x1dcaab&&_0x1dcaab[_0x585871(0x245)]();}}async[_0x4f7dfb(0x257)](_0x1d2640,_0xab5c49){const _0x436ecb=_0x4f7dfb;var _0x18d007,_0x298523,_0x26a54c,_0x1404f9;if(await this['badwordsService'][_0x436ecb(0x2c1)](_0x1d2640[_0x436ecb(0x225)]))throw new common_1[(_0x436ecb(0x256))](_0x436ecb(0x2f6),common_1['HttpStatus']['BAD_REQUEST']);common_1[_0x436ecb(0x27f)][_0x436ecb(0x20b)]('draw\x20paompt\x20info\x20<======*******======>\x20'+_0x1d2640['prompt'],_0x436ecb(0x1f4)),await this[_0x436ecb(0x284)][_0x436ecb(0x1c7)](_0xab5c49[_0x436ecb(0x1d3)]['id']),await this[_0x436ecb(0x1e9)]['validateBalance'](_0xab5c49[_0x436ecb(0x1d3)]['id'],balance_constant_1[_0x436ecb(0x314)][_0x436ecb(0x25d)],_0x1d2640['n']||0x1);const _0x4c6172=await this[_0x436ecb(0x2f9)][_0x436ecb(0x2aa)]([_0x436ecb(0x1e1)])||'https://api.openai.com',_0x3ab370=_0x4c6172+_0x436ecb(0x212);let _0x5f48f3=[];const _0x2d3a9a=await this[_0x436ecb(0x235)](0x3),{key:_0x551ba8}=_0x2d3a9a;try{const _0x5c8e68=await axios_1[_0x436ecb(0x2e5)][_0x436ecb(0x1e5)](_0x3ab370,Object[_0x436ecb(0x2db)](Object[_0x436ecb(0x2db)]({},_0x1d2640),{'response_format':_0x436ecb(0x22b)}),{'headers':{'Authorization':'Bearer\x20'+_0x551ba8}});_0x5f48f3=_0x5c8e68[_0x436ecb(0x2fb)][_0x436ecb(0x2fb)];}catch(_0x4070ae){console[_0x436ecb(0x20b)](_0x436ecb(0x1d1),_0x4070ae);const _0xc4f351=((_0x18d007=_0x4070ae===null||_0x4070ae===void 0x0?void 0x0:_0x4070ae[_0x436ecb(0x2c4)])===null||_0x18d007===void 0x0?void 0x0:_0x18d007['status'])||0x1f4,_0x3f8465=(_0x1404f9=(_0x26a54c=(_0x298523=_0x4070ae===null||_0x4070ae===void 0x0?void 0x0:_0x4070ae[_0x436ecb(0x2c4)])===null||_0x298523===void 0x0?void 0x0:_0x298523[_0x436ecb(0x2fb)])===null||_0x26a54c===void 0x0?void 0x0:_0x26a54c['error'])===null||_0x1404f9===void 0x0?void 0x0:_0x1404f9[_0x436ecb(0x22f)];if(_0xc4f351===0x1ad)throw new common_1[(_0x436ecb(0x256))](_0x436ecb(0x266),common_1[_0x436ecb(0x218)][_0x436ecb(0x301)]);if(_0xc4f351===0x190||_0x3f8465[_0x436ecb(0x25b)](_0x436ecb(0x2f4)))throw new common_1[(_0x436ecb(0x256))](_0x436ecb(0x31a),common_1[_0x436ecb(0x218)]['BAD_REQUEST']);if(_0xc4f351===0x1f4)throw new common_1[(_0x436ecb(0x256))](_0x436ecb(0x1cc),common_1['HttpStatus'][_0x436ecb(0x301)]);if(_0xc4f351===0x191)throw new common_1[(_0x436ecb(0x256))](_0x436ecb(0x23f),common_1[_0x436ecb(0x218)][_0x436ecb(0x301)]);throw new common_1['HttpException'](_0x436ecb(0x2c3),common_1['HttpStatus'][_0x436ecb(0x301)]);}const _0x50f24f=[];for(const _0x499605 of _0x5f48f3){const _0x303baa=uuid['v4']()['slice'](0x0,0xa)+_0x436ecb(0x27a),_0x284b6c=Buffer[_0x436ecb(0x22d)](_0x499605[_0x436ecb(0x22b)],'base64');_0x50f24f[_0x436ecb(0x2fe)](this[_0x436ecb(0x260)]['uploadFile']({'filename':_0x303baa,'buffer':_0x284b6c}));}const _0x556c70=await Promise[_0x436ecb(0x24f)](_0x50f24f);await this['userBalanceService'][_0x436ecb(0x1d0)](_0xab5c49[_0x436ecb(0x1d3)]['id'],_0x436ecb(0x286),_0x1d2640['n'],_0x1d2640['n']||0x1);const _0x471655=(0x0,utils_1[_0x436ecb(0x258)])(_0xab5c49),_0x33b9eb=[],_0x41be45=await this[_0x436ecb(0x260)][_0x436ecb(0x2d6)](),[_0x137b28,_0x159ba4]=_0x1d2640['size'][_0x436ecb(0x22a)]('x');return _0x556c70[_0x436ecb(0x2ec)](_0x5c8bce=>{const _0x5c0d67=_0x436ecb;_0x33b9eb['push'](this[_0x5c0d67(0x255)]['saveChatLog']({'curIp':_0x471655,'userId':_0xab5c49[_0x5c0d67(0x1d3)]['id'],'type':balance_constant_1[_0x5c0d67(0x314)][_0x5c0d67(0x25d)],'prompt':_0x1d2640[_0x5c0d67(0x225)],'answer':_0x5c8bce,'fileInfo':JSON['stringify']({'cosType':_0x41be45,'width':_0x137b28,'height':_0x159ba4,'cosUrl':_0x5c8bce}),'promptTokens':0x0,'completionTokens':0x0,'totalTokens':0x0,'model':'DALL-E2'}));}),await Promise[_0x436ecb(0x24f)](_0x33b9eb),_0x556c70;}async['getKeyDetail'](_0xdf0914){const _0x2cf420=_0x4f7dfb;var _0x344ec9;const _0x4ecbdc=await this['globalConfigService'][_0x2cf420(0x2aa)]([_0x2cf420(0x1e1)])||_0x2cf420(0x1eb),_0x368175=_0x4ecbdc;try{const _0x421c7f={'Content-Type':_0x2cf420(0x203),'Authorization':_0x2cf420(0x297)+_0xdf0914},_0x54be6b=dayjs()[_0x2cf420(0x231)](_0x2cf420(0x1d2)),_0x45181b=dayjs()[_0x2cf420(0x319)](0x63,_0x2cf420(0x202))[_0x2cf420(0x231)](_0x2cf420(0x1d2)),_0x34211a=await axios_1['default'][_0x2cf420(0x1f7)](_0x368175+_0x2cf420(0x265)+_0x45181b+'&end_date='+_0x54be6b,{'headers':_0x421c7f}),_0xc0612a=(_0x344ec9=_0x34211a===null||_0x34211a===void 0x0?void 0x0:_0x34211a[_0x2cf420(0x2fb)][_0x2cf420(0x248)])!==null&&_0x344ec9!==void 0x0?_0x344ec9:0x0,_0xfe3d10=await axios_1[_0x2cf420(0x2e5)][_0x2cf420(0x1f7)](_0x368175+_0x2cf420(0x1ce),{'headers':_0x421c7f}),{has_payment_method:_0x119642,hard_limit_usd:_0x16e151,access_until:_0xa427c2}=_0xfe3d10[_0x2cf420(0x2fb)],_0x3aa903=(_0xc0612a/0x64)[_0x2cf420(0x1ec)](0x2),_0x3b2571=Number(_0x16e151)[_0x2cf420(0x1ec)](0x0);return{'totalAmount':_0x3b2571+'$','useAmount':_0x3aa903+'$','balance':(Number(_0x3b2571)-Number(_0x3aa903))['toFixed'](0x2)+'$','isBindCard':_0x119642,'expirDate':dayjs(_0xa427c2*0x3e8)['format']('YYYY年M月D日'),'status':0x1};}catch(_0x2fa89f){return{'status':-0x1};}}async[_0x4f7dfb(0x27b)](_0x543621,_0x57f389){const _0x2007e5=_0x4f7dfb;let _0x332d47={};_0x332d47=await this[_0x2007e5(0x235)](_0x57f389);const {model:_0x50156f,key:_0x557557,id:_0x531864,secretKey:_0x3db470}=_0x332d47;return await this[_0x2007e5(0x1e4)][_0x2007e5(0x23b)]()[_0x2007e5(0x24c)](gptKeys_entity_1['GptKeysEntity'])[_0x2007e5(0x1e0)]({'useCount':()=>'useCount\x20+\x201'})[_0x2007e5(0x209)](_0x2007e5(0x21a),{'id':_0x531864})[_0x2007e5(0x305)](),_0x332d47;}async[_0x4f7dfb(0x2fa)](_0x3e2a78){const _0x43ee23=_0x4f7dfb,_0x45bb3b=await this[_0x43ee23(0x2f9)]['getConfigs']([_0x43ee23(0x1e1)])||'https://api.openai.com',_0x4f050e=_0x45bb3b+_0x43ee23(0x2af);try{const _0x56a15f=await axios_1[_0x43ee23(0x2e5)]['get'](_0x4f050e,{'headers':{'Authorization':_0x43ee23(0x297)+_0x3e2a78}}),_0x4b77a2=_0x56a15f['data'][_0x43ee23(0x2fb)][_0x43ee23(0x2d5)](_0x5daf4e=>_0x5daf4e['id']),_0x1c95e0=[_0x43ee23(0x2c2),_0x43ee23(0x292),'qwen-v1',_0x43ee23(0x277),'chatglm_pro',_0x43ee23(0x2e8),_0x43ee23(0x21d),'sparkdesk',_0x43ee23(0x20e),_0x43ee23(0x1f9),_0x43ee23(0x270),'gpt-4-0314',_0x43ee23(0x2b2),_0x43ee23(0x278),_0x43ee23(0x280),_0x43ee23(0x282),'gpt-3.5-turbo-16k',_0x43ee23(0x26d),'ada',_0x43ee23(0x2b1)],_0x39face=_0x1c95e0[_0x43ee23(0x29a)](_0x50ad19=>_0x4b77a2['includes'](_0x50ad19));return _0x39face;}catch(_0x2760ed){throw new common_1[(_0x43ee23(0x256))](_0x43ee23(0x1f6),common_1[_0x43ee23(0x218)]['BAD_REQUEST']);}}async[_0x4f7dfb(0x28d)](_0xd88f21,_0x4e8a86){const _0x41f60b=_0x4f7dfb;try{const _0x22e5a0={},{page:page=0x1,size:size=0xa,key:_0x3e313c,status:_0x48e36c,keyStatus:_0x1c0969,model:_0x35e3ad}=_0xd88f21;_0x3e313c&&(_0x22e5a0[_0x41f60b(0x21c)]=(0x0,typeorm_1[_0x41f60b(0x204)])('%'+_0x3e313c+'%')),_0x1c0969&&(_0x22e5a0[_0x41f60b(0x1dd)]=_0x1c0969),_0x35e3ad&&(_0x22e5a0[_0x41f60b(0x2ac)]=_0x35e3ad),[0x0,0x1,'0','1','-1',-0x1]['includes'](_0x48e36c)&&(_0x22e5a0['status']=_0x48e36c);const [_0x8cfb4d,_0x5972c4]=await this[_0x41f60b(0x1e4)][_0x41f60b(0x28b)]({'skip':(page-0x1)*size,'take':size,'where':_0x22e5a0,'order':{'id':_0x41f60b(0x252)}}),_0x3f6267=[];_0x8cfb4d[_0x41f60b(0x2ec)](_0x240f6a=>_0x3f6267[_0x41f60b(0x2fe)](this[_0x41f60b(0x29e)](_0x240f6a[_0x41f60b(0x21c)])));const _0x372867=await Promise[_0x41f60b(0x24f)](_0x3f6267);return _0x8cfb4d[_0x41f60b(0x2ec)]((_0x498442,_0x270959)=>_0x498442[_0x41f60b(0x307)]=_0x372867[_0x270959]),_0x4e8a86[_0x41f60b(0x1d3)]['role']!==_0x41f60b(0x312)&&_0x8cfb4d[_0x41f60b(0x2ec)](_0x49bff8=>{const _0x3cc886=_0x41f60b;_0x49bff8[_0x3cc886(0x21c)]=_0x49bff8['key']?(0x0,utils_1[_0x3cc886(0x1f8)])(_0x49bff8[_0x3cc886(0x21c)]):'',_0x49bff8[_0x3cc886(0x2ce)]=_0x49bff8['openaiProxyUrl']?(0x0,utils_1[_0x3cc886(0x1f8)])(_0x49bff8[_0x3cc886(0x2ce)]):'';}),{'rows':_0x8cfb4d,'count':_0x5972c4};}catch(_0x463bf8){console['log'](_0x41f60b(0x207),_0x463bf8);throw new common_1['HttpException'](_0x41f60b(0x2eb),common_1[_0x41f60b(0x218)]['BAD_REQUEST']);}}async[_0x4f7dfb(0x2d0)](_0x3c78aa){const _0x5ab975=_0x4f7dfb,{key:_0x576d43,secretKey:_0x2de481,manufacturer:_0x5a8e9e,model:_0x5a247e}=_0x3c78aa,_0x5e3bb1=await this['gptKeysEntity'][_0x5ab975(0x229)]({'where':{'key':_0x576d43,'secretKey':_0x2de481,'manufacturer':_0x5a8e9e,'model':_0x5a247e}});if(_0x5e3bb1)throw new common_1['HttpException']('已存在相同配置',common_1[_0x5ab975(0x218)][_0x5ab975(0x301)]);const _0x27c0e4=await this['gptKeysEntity']['save'](_0x3c78aa);return await this[_0x5ab975(0x214)](),_0x27c0e4;}async[_0x4f7dfb(0x1ee)](_0x32b519){}async['updateKey'](_0x3ed263){const _0x148c50=_0x4f7dfb,{id:_0x3f82c5}=_0x3ed263,_0x1c6f9d=await this['gptKeysEntity']['findOne']({'where':{'id':_0x3f82c5}});if(!_0x1c6f9d)throw new common_1[(_0x148c50(0x256))]('key不存在',common_1[_0x148c50(0x218)][_0x148c50(0x301)]);const _0x593950=await this[_0x148c50(0x1e4)][_0x148c50(0x24c)]({'id':_0x3f82c5},_0x3ed263);if(_0x593950[_0x148c50(0x308)]>0x0)return await this[_0x148c50(0x214)](),_0x148c50(0x281);else throw new common_1[(_0x148c50(0x256))](_0x148c50(0x28e),common_1[_0x148c50(0x218)][_0x148c50(0x301)]);}async[_0x4f7dfb(0x2bb)](_0x18ca64){const _0x2466cc=_0x4f7dfb,{id:_0xcc13e5}=_0x18ca64,_0x598dc3=await this['gptKeysEntity'][_0x2466cc(0x229)]({'where':{'id':_0xcc13e5}});if(!_0x598dc3)throw new common_1[(_0x2466cc(0x256))](_0x2466cc(0x25e),common_1[_0x2466cc(0x218)][_0x2466cc(0x301)]);const _0x3e5527=await this[_0x2466cc(0x1e4)][_0x2466cc(0x1f3)]({'id':_0xcc13e5});if(_0x3e5527['affected']>0x0)return await this[_0x2466cc(0x214)](),_0x2466cc(0x2a0);else throw new common_1['HttpException'](_0x2466cc(0x230),common_1[_0x2466cc(0x218)]['BAD_REQUEST']);}async[_0x4f7dfb(0x214)](){const _0x429022=_0x4f7dfb,_0x868eb2=await this['gptKeysEntity'][_0x429022(0x1e7)]({'where':{'status':0x1},'select':['id',_0x429022(0x1f0),_0x429022(0x21c),_0x429022(0x289),_0x429022(0x206),_0x429022(0x2ac),_0x429022(0x2bd),_0x429022(0x1da),_0x429022(0x2ce),_0x429022(0x29b)]}),_0x285d5c=_0x868eb2[_0x429022(0x29a)](_0x3398f0=>_0x3398f0['model']==='erniebot'),_0x4c39a7=_0x868eb2[_0x429022(0x29a)](_0x443f12=>_0x443f12[_0x429022(0x2ac)]==='erniebot-turbo'),_0x52606d=_0x868eb2[_0x429022(0x29a)](_0x12b268=>_0x12b268[_0x429022(0x2ac)]['includes']('gpt-3')),_0x3256f2=_0x868eb2['filter'](_0x370351=>_0x370351[_0x429022(0x2ac)][_0x429022(0x25b)]('gpt-4')),_0x2f9837=_0x868eb2['filter'](_0x24898c=>_0x24898c[_0x429022(0x2ac)]==='qwen-v1'),_0x576afa=_0x868eb2['filter'](_0x21e6bd=>_0x21e6bd[_0x429022(0x2ac)]==='chatglm_pro'),_0x1161be=_0x868eb2['filter'](_0x3b57e6=>_0x3b57e6[_0x429022(0x2ac)]===_0x429022(0x205));this[_0x429022(0x2d2)]={'list1':_0x285d5c,'list2':_0x4c39a7,'list3':_0x52606d,'list4':_0x3256f2,'list6':_0x2f9837,'list7':_0x576afa,'list8':_0x1161be};}async[_0x4f7dfb(0x294)](){const _0x196852=_0x4f7dfb,_0x350dee=await this[_0x196852(0x28a)][_0x196852(0x1e7)]({'where':{'status':0x1,'count':(0x0,typeorm_1[_0x196852(0x2b5)])(0x0)},'select':[_0x196852(0x30c)]});this['whiteListUser']=_0x350dee[_0x196852(0x2d5)](_0x11176e=>_0x11176e[_0x196852(0x30c)]);}async['addWhiteUser'](_0x41bf04){const _0x60314f=_0x4f7dfb,{userId:_0x1367e8,count:_0x242378}=_0x41bf04,_0x2305df=await this[_0x60314f(0x28a)][_0x60314f(0x229)]({'where':{'userId':_0x1367e8}});if(_0x2305df)throw new common_1['HttpException'](_0x60314f(0x24e),common_1['HttpStatus'][_0x60314f(0x301)]);const _0x2e581b=await this[_0x60314f(0x28a)]['save'](_0x41bf04);return await this[_0x60314f(0x294)](),_0x2e581b;}async[_0x4f7dfb(0x20c)](_0x3306ed){const _0x3295cd=_0x4f7dfb,{id:_0x20393a}=_0x3306ed,_0x1f5789=await this['whiteListEntity'][_0x3295cd(0x229)]({'where':{'id':_0x20393a}});if(!_0x1f5789)throw new common_1[(_0x3295cd(0x256))](_0x3295cd(0x227),common_1[_0x3295cd(0x218)]['BAD_REQUEST']);const _0x8319e0=await this['whiteListEntity'][_0x3295cd(0x24c)]({'id':_0x20393a},_0x3306ed);if(_0x8319e0[_0x3295cd(0x308)]>0x0)return await this[_0x3295cd(0x294)](),_0x3295cd(0x2b7);else throw new common_1['HttpException'](_0x3295cd(0x250),common_1[_0x3295cd(0x218)][_0x3295cd(0x301)]);}async[_0x4f7dfb(0x1df)](_0x1845d0,_0x19d549){const _0x110298=_0x4f7dfb,{page:page=0x1,size:size=0xa}=_0x1845d0,[_0x12930f,_0x4f27a9]=await this['whiteListEntity']['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'id':_0x110298(0x252)}}),_0x4fa024=_0x12930f[_0x110298(0x2d5)](_0x49f44a=>_0x49f44a[_0x110298(0x30c)]),_0x372e4c=await this['userEntity'][_0x110298(0x1e7)]({'where':{'id':(0x0,typeorm_1['In'])(_0x4fa024)}});return _0x12930f[_0x110298(0x2ec)](_0x101075=>{const _0x5c20ef=_0x110298;var _0x2ada61,_0x1c0ae6;const _0x13af9e=_0x372e4c[_0x5c20ef(0x1e7)](_0x46ab42=>_0x46ab42['id']===_0x101075[_0x5c20ef(0x30c)]);_0x101075['username']=(_0x2ada61=_0x13af9e===null||_0x13af9e===void 0x0?void 0x0:_0x13af9e['username'])!==null&&_0x2ada61!==void 0x0?_0x2ada61:'',_0x101075[_0x5c20ef(0x2ef)]=(_0x1c0ae6=_0x13af9e===null||_0x13af9e===void 0x0?void 0x0:_0x13af9e[_0x5c20ef(0x2ef)])!==null&&_0x1c0ae6!==void 0x0?_0x1c0ae6:'';}),_0x19d549[_0x110298(0x1d3)][_0x110298(0x1e3)]!==_0x110298(0x312)&&_0x12930f[_0x110298(0x2ec)](_0xf90f19=>_0xf90f19[_0x110298(0x2ef)]=(0x0,utils_1[_0x110298(0x1ea)])(_0xf90f19[_0x110298(0x2ef)])),{'rows':_0x12930f,'count':_0x4f27a9};}async[_0x4f7dfb(0x1d5)](_0x101084){const _0x164e2d=_0x4f7dfb,_0x1a830a=await this['gptKeysEntity']['update']({'key':_0x101084},{'status':-0x1,'keyStatus':0x0});common_1['Logger']['error'](_0x164e2d(0x236)+_0x101084+'\x20欠费，已被系统自动锁定'),await this['getAllKeyList']();}async[_0x4f7dfb(0x310)](_0x53c2f0){const _0x490f06=_0x4f7dfb,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,baiduErnieMaxTokens:baiduErnieMaxTokens=0x0,baiduErnieMaxTokensRES:baiduErnieMaxTokensRES=0x0,baiduErnieTurboMaxTokens:baiduErnieTurboMaxTokens=0x0,baiduErnieTurboMaxTokensRES:baiduErnieTurboMaxTokensRES=0x0,aliyunQwenMaxTokens:aliyunQwenMaxTokens=0x0,aliyunQwenMaxTokensRES:aliyunQwenMaxTokensRES=0x0,zhipuChatGLMProMaxTokens:zhipuChatGLMProMaxTokens=0x0,zhipuChatGLMProMaxTokensRES:zhipuChatGLMProMaxTokensRES=0x0,xunfeiSparkDeskMaxTokens:xunfeiSparkDeskMaxTokens=0x0,xunfeiSparkDeskMaxTokensRES:xunfeiSparkDeskMaxTokensRES=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x490f06(0x2f9)][_0x490f06(0x2aa)]([_0x490f06(0x254),_0x490f06(0x30f),_0x490f06(0x2a9),_0x490f06(0x2dd),_0x490f06(0x1d7),'openaiModel4MaxTokensRes','openaiModel4MaxTokens32k',_0x490f06(0x200),_0x490f06(0x1ca),_0x490f06(0x21b),_0x490f06(0x285),_0x490f06(0x30d),_0x490f06(0x2b0),_0x490f06(0x2b6),_0x490f06(0x210),_0x490f06(0x2a3),_0x490f06(0x234),'xunfeiSparkDeskMaxTokensRES',_0x490f06(0x1e1)]);let _0x53fbb1=null,_0x30662f=null,_0x177ecf=null;const {model:_0x179659,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,openaiProxyUrl:openaiProxyUrl='',key:_0xe96383,secretKey:_0x291e20,manufacturer:_0x12135c}=_0x53c2f0;return _0x179659[_0x490f06(0x276)]()['includes'](_0x490f06(0x270))&&(_0x179659['toLowerCase']()['includes'](_0x490f06(0x2e9))?(_0x53fbb1=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x30662f=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000):(_0x53fbb1=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x30662f=maxResponseTokens||openaiModel4MaxTokensRes||0x1000)),_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)](_0x490f06(0x2c8))&&(_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)](_0x490f06(0x244))?(_0x53fbb1=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x30662f=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000):(_0x53fbb1=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x30662f=maxResponseTokens||openaiModel3MaxTokensRes||0x3e8)),_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)]('erniebot')&&(_0x179659[_0x490f06(0x276)]()['includes'](_0x490f06(0x274))?(_0x53fbb1=maxModelTokens||baiduErnieTurboMaxTokens||0x7c1,_0x30662f=maxResponseTokens||baiduErnieTurboMaxTokensRES||0xf4240):(_0x53fbb1=maxModelTokens||baiduErnieMaxTokens||0x15d,_0x30662f=maxResponseTokens||baiduErnieMaxTokensRES||0xf4240)),_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)]('qwen-v1')&&(_0x53fbb1=maxModelTokens||aliyunQwenMaxTokens||0x5dc,_0x30662f=maxResponseTokens||aliyunQwenMaxTokensRES||0xf4240),_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)](_0x490f06(0x220))&&(_0x53fbb1=maxModelTokens||zhipuChatGLMProMaxTokens||0x6c3,_0x30662f=maxResponseTokens||zhipuChatGLMProMaxTokensRES||0x186a0),_0x179659[_0x490f06(0x276)]()[_0x490f06(0x25b)](_0x490f06(0x205))&&(_0x53fbb1=maxModelTokens||xunfeiSparkDeskMaxTokens||0x1cf6,_0x30662f=maxResponseTokens||xunfeiSparkDeskMaxTokensRES||0x1ffe),_0x177ecf=openaiProxyUrl||openaiBaseUrl||_0x490f06(0x1eb),_0x30662f>=_0x53fbb1&&[_0x490f06(0x28f),_0x490f06(0x26e)][_0x490f06(0x2f7)](_0x12135c['toLowerCase']())>-0x1&&(_0x30662f=Math['floor'](_0x53fbb1/0x2),common_1[_0x490f06(0x27f)][_0x490f06(0x2d7)]('key:\x20'+_0xe96383+_0x490f06(0x2bf)+_0x30662f)),{'key':_0xe96383,'maxToken':_0x53fbb1,'maxTokenRes':_0x30662f,'proxyUrl':_0x177ecf,'secretKey':_0x291e20};}};ChatgptService=__decorate([(0x0,common_1[_0x4f7dfb(0x2f1)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(user_entity_1[_0x4f7dfb(0x20d)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(gptKeys_entity_1[_0x4f7dfb(0x2ed)])),__param(0x2,(0x0,typeorm_2['InjectRepository'])(config_entity_1[_0x4f7dfb(0x25f)])),__param(0x3,(0x0,typeorm_2[_0x4f7dfb(0x264)])(whiteList_entity_1[_0x4f7dfb(0x313)])),__param(0x4,(0x0,typeorm_2[_0x4f7dfb(0x264)])(app_entity_1[_0x4f7dfb(0x1dc)])),__metadata('design:paramtypes',[typeorm_1[_0x4f7dfb(0x2de)],typeorm_1['Repository'],typeorm_1[_0x4f7dfb(0x2de)],typeorm_1['Repository'],typeorm_1['Repository'],nestjs_config_1[_0x4f7dfb(0x2c5)],userBalance_service_1[_0x4f7dfb(0x293)],chatLog_service_1[_0x4f7dfb(0x316)],user_service_1[_0x4f7dfb(0x2df)],upload_service_1[_0x4f7dfb(0x232)],badwords_service_1[_0x4f7dfb(0x1cb)],autoreply_service_1[_0x4f7dfb(0x30e)],globalConfig_service_1[_0x4f7dfb(0x24b)],fanyi_service_1[_0x4f7dfb(0x1fa)]])],ChatgptService),exports[_0x4f7dfb(0x311)]=ChatgptService;function _0x48ec(_0x1d7051,_0xbe4c7d){const _0x22b7df=_0x22b7();return _0x48ec=function(_0x48ec06,_0x15f42f){_0x48ec06=_0x48ec06-0x1c7;let _0x1375a1=_0x22b7df[_0x48ec06];return _0x1375a1;},_0x48ec(_0x1d7051,_0xbe4c7d);}function _0x22b7(){const _0x43a0b5=['filter','openaiTimeoutMs','openaiaAtoDowngrade','stringify','getKeyDetail','nestjs-config','删除成功','_getTokenCount','parse','zhipuChatGLMProMaxTokensRES','未配置有效key、请先前往后台系统配置！','conversationId','../../common/constants/errorMessage.constant','axios','setHeader','openaiModel3MaxTokens16k','getConfigs','status','model','importDynamic','Aliyun','/v1/models','aliyunQwenMaxTokens','davinci','gpt-4-0613','onModuleInit','171yeTmyF','MoreThan','aliyunQwenMaxTokensRES','修改白名单成功','expires_in','apiKey','lei-ai-default-key','deleteKey','getBaiduAccessToken\x20success:\x20','maxModelTokens','@nestjs/typeorm','\x20回复数不得大于等于模型上下文数,\x20已自动调整为\x20maxTokenRes:\x20','797754wkhrRZ','checkBadWords','erniebot','绘制图片失败，请稍后试试吧！','response','ConfigService','metadata','\x0a\x20Respond\x20using\x20markdown.\x20\x0a\x20Current\x20date:\x20','gpt-3','./gptKeys.entity','&grant_type=client_credentials','__decorate','157jHhPqH','getBaiduAccessToken\x20error:\x20','openaiProxyUrl','../globalConfig/config.entity','addKey','126108mYAEnb','keyPool','catch','length','map','getUploadType','debug','../app/app.entity','服务异常、请重新试试吧！！！','../fanyi/fanyi.service','assign','getZhipuToken\x20success:\x20','openaiModel3MaxTokens16kRes','Repository','UserService','then','getTime','8139307QSRKIq','1146WvorjV','dayjs','default','xunfei','->userId\x20','chatglm_std','32k','abortController','查询key列表失败','forEach','GptKeysEntity','defaultBase','email','apiBaseUrl','Injectable','\x20\x20提示信息是：','statusCode','Your\x20request\x20was\x20rejected\x20as\x20a\x20result\x20of\x20our\x20safety\x20system','write','您的绘画描述词中含有不合规信息、请检查后重新提交！','indexOf','systemPreMessage','globalConfigService','getGptModelList','data','object','?access_token=','push','未配置[卡池2]的有效key、请先前往后台系统配置！','encode','BAD_REQUEST','REDIS_USER','64EYXZbW','jwt-simple','execute','OpenAI','keyDetail','affected','zhipuCache','userBanance','text','userId','baiduErnieTurboMaxTokensRES','AutoreplyService','openaiModel3MaxTokensRes','formatModelToken','ChatgptService','super','WhiteListEntity','DeductionKey','removeSpecialCharacters','ChatLogService','keyv','../../common/utils','subtract','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','checkUserStatus','req\x20mergedOptions:\x20:\x20','aliyun','baiduErnieMaxTokens','BadwordsService','绘制图片失败，请检查你的提示词是否有非法描述！','-error','/v1/dashboard/billing/subscription','getBaiduAccessToken','deductFromBalance','openai-draw','YYYY-MM-DD','user','configService','lockKey','./../user/user.service','openaiModel4MaxTokens','/sse-invoke','baidu','maxResponseTokens','未配置[卡池8]的有效key、请先前往后台系统配置！','AppEntity','keyStatus','close','getWhiteListUser','set','openaiBaseUrl','defineProperty','role','gptKeysEntity','post','access_token','find','application/octet-stream;\x20charset=utf-8','userBalanceService','maskEmail','https://api.openai.com','toFixed','detail','bulkCreateKey','getGptParams','manufacturer','135PppHDx','aipAccessToken','delete','DrawService','validateBalance','获取模型列表失败，请检查你的key是否正确！','get','hideString','gpt-35-turbo-16k','FanyiService','本次使用的:\x20model:\x20','上下文过长错误！！！！','whiteListUser','env','string','openaiModel4MaxTokens32kRes','appEntity','day','application/json','Like','sparkdesk','weight','error:\x20','CHAT_TYPE','where','badwordsService','log','updateWhiteUser','UserEntity','gpt-35-turbo','HS256','zhipuChatGLMProMaxTokens','replace','/v1/images/generations','__metadata','getAllKeyList','typeorm','zhipu','&client_secret=','HttpStatus','REDIS_PASSWORD','id\x20=\x20:id','baiduErnieMaxTokensRES','key','chatglm_lite','saveChatLog','Azure','chatglm_pro','signal','assistant','toISOString','../chatLog/chatLog.service','prompt','zhipuAccessToken','当前记录不存在！','未配置[卡池3]的有效key、请先前往后台系统配置！','findOne','split','b64_json','@keyv/redis','from','OpenAiErrorCodeMessage','message','删除失败','format','UploadService','__esModule','xunfeiSparkDeskMaxTokens','getRandomGptKeyDetail','key:\x20','../globalConfig/globalConfig.service','未配置[卡池1]的有效key、请先前往后台系统配置！','https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/','parentMessageId','createQueryBuilder','baiduCache','SIGN','req\x20apiBaseUrl:\x20','绘制图片失败，此次绘画被拒绝了！','124887qQuJFV','4GXAzgU','内容中含有敏感词汇、我们已对您的账号进行标记、多次违规将触发账号永久封禁、请注意您的言论！','PAYMENT_REQUIRED','16k','end','\x20key\x20->\x20','checkAutoReply','total_usage','\x20maxResponseTokens:\x20','selectKeyWithWeight','GlobalConfigService','update','systemMessage','用户已在白名单中！','all','修改白名单失败','userEntity','DESC','getZhipuToken','openaiModel3MaxTokens','chatLogService','HttpException','draw','getClientIp','preset','function','includes','../autoreply/autoreply.service','PAINT_TYPE','key不存在','ConfigEntity','uploadService','chatProcess','/openai/deployments/','438210geAHzm','InjectRepository','/v1/dashboard/billing/usage?start_date=','当前请求已过载、请稍等会儿再试试吧！','sendMessage','Baidu','15174120udfbjk','You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.','/v1','eb-instant','code-davinci-002','azure','Please\x20check\x20the\x20back-end\x20console','gpt-4','../../common/constants/balance.constant','configEntity','getOwnPropertyDescriptor','turbo','floor','toLowerCase','qwen-plus-v1','gpt-3.5-turbo','未配置[卡池6]的有效key、请先前往后台系统配置！','.png','getModelAndKeyFromUser','REDIS_HOST','REDIS_PORT','leiai-chatlog','Logger','gpt-3.5-turbo-0301','修改成功','gpt-3.5-turbo-16k-0613','decorate','userService','baiduErnieTurboMaxTokens','model3','未配置[卡池7]的有效key、请先前往后台系统配置！','LEIAI_USER_QUESTION_CONTENT','secretKey','whiteListEntity','findAndCount','有4的权限但是卡池没有配置、降级为3的卡池','getKeyList','修改失败','openai','leiai-baidu','https://open.bigmodel.cn/api/paas/v3/model-api/','erniebot-turbo','UserBalanceService','getUserWhiteList','uuid','../user/user.entity','Bearer\x20','api','model4'];_0x22b7=function(){return _0x43a0b5;};return _0x22b7();}