
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ke}from"./index-b1f68172.js";import{A}from"./chatgpt-ebdb061b.js";import{u as _e}from"./utcformatTime-e76e5157.js";import{M as X,b as ge,c as be,Q as we,d as ve,S as Ve}from"./index-ebb5170c.js";import{d as xe,r as k,R as v,B as H,x as Te,o as f,c as D,e as l,f as t,N as R,S as P,b as r,k as u,a as N,w as q,I as b,t as y,J as Ue,U as Z,E as T,W as Me,h as p,X as Ce,q as E}from"./index-18448298.js";const Ae={style:{float:"right"}},De={class:"flex justify-end mr-5"},Se={class:"flex justify-end mr-5"},he=xe({__name:"list",setup(Le){const O=k(),Y=k(),j=k(0),w=k(!1),S=k(!1),G=k(!1),U=k(!1),ee=v(ve),le=v(X),te=v(Ve),h=v({keyList:""}),c=v({key:"",model:"",status:"",page:1,size:10}),L=k(),V=k(0),o=v({manufacturer:"",key:"",secretKey:"",model:"",maxModelTokens:null,maxResponseTokens:null,openaiProxyUrl:"",openaiTimeoutMs:null,weight:1,status:1}),ae=v({key:[{required:!0,message:"请填写您的key",trigger:"blur"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],weight:[{required:!1,message:"请填写key的权重值",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],maxModelTokens:[{required:!1,message:"请填写模型最大token数",trigger:"blur"}],maxResponseTokens:[{required:!1,message:"请填写最大回复token数",trigger:"blur"}],openaiProxyUrl:[{required:!1,message:"请填写指定代理地址",trigger:"blur"}]});function F(n){V.value=0,n==null||n.resetFields()}const oe=H(()=>V.value?"更新秘钥":"新增秘钥"),Q=H(()=>V.value?"确认更新":"确认新增"),J=k([]);async function _(){try{S.value=!0;const n=await A.queryKeyList(c);S.value=!1;const{rows:a,count:m}=n.data;j.value=m,J.value=a}catch{S.value=!1}}async function ne(n){const{id:a}=n;await A.deleteGptKey({id:a}),T({type:"success",message:"删除秘钥成功！"}),_()}function se(n){V.value=n.id;const{manufacturer:a,key:m,secretKey:s,model:g,weight:x,status:d,type:K,maxModelTokens:I,maxResponseTokens:M,openaiProxyUrl:C,openaiTimeoutMs:z}=n;Me(()=>{Object.assign(o,{manufacturer:a,key:m,secretKey:s,model:g,weight:x,status:d,type:K,maxModelTokens:I,maxResponseTokens:M,openaiProxyUrl:C,openaiTimeoutMs:z})}),w.value=!0}function re(n){n==null||n.resetFields(),_()}async function ue(n){n==null||n.validate(async a=>{a&&(V.value?(await A.updateGptKey({id:V.value,...o}),T({type:"success",message:"更新秘钥成功！"})):(await A.addGptKey(o),T({type:"success",message:"添加秘钥成功！"})),w.value=!1,_())})}function de(n){n==null||n.validate(async a=>{if(a){const{keyList:m}=h,s=m.split(`
`);if(s.length>100)return T.error("批量添加key不能超过100个");if(!s.length)return T.error("请按要求填写您的key秘钥");const g=await A.builCreateGptKey({keyList:s});h.keyList="",T({type:"success",message:g.data}),U.value=!1,_()}})}return Te(()=>{_()}),(n,a)=>{const m=p("el-input"),s=p("el-form-item"),g=p("el-option"),x=p("el-select"),d=p("el-button"),K=p("Plus"),I=p("el-icon"),M=p("el-form"),C=ke,z=p("el-alert"),i=p("el-table-column"),$=p("el-tag"),ie=p("el-popconfirm"),pe=p("el-table"),me=p("el-pagination"),fe=p("el-row"),ye=p("el-switch"),W=p("el-dialog"),B=Ce("loading");return f(),D("div",null,[l(C,null,{default:t(()=>[l(M,{ref_key:"formRef",ref:Y,inline:!0,model:c},{default:t(()=>[l(s,{label:"key",prop:"key"},{default:t(()=>[l(m,{modelValue:c.key,"onUpdate:modelValue":a[0]||(a[0]=e=>c.key=e),placeholder:"sk-*** [模糊搜索]"},null,8,["modelValue"])]),_:1}),l(s,{label:"使用模型",prop:"model"},{default:t(()=>[l(x,{modelValue:c.model,"onUpdate:modelValue":a[1]||(a[1]=e=>c.model=e),placeholder:"请选择绑定的模型",clearable:""},{default:t(()=>[(f(!0),D(R,null,P(r(X),e=>(f(),b(g,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"启用状态",prop:"status"},{default:t(()=>[l(x,{modelValue:c.status,"onUpdate:modelValue":a[2]||(a[2]=e=>c.status=e),placeholder:"请选择key启用状态",clearable:""},{default:t(()=>[(f(!0),D(R,null,P(r(ge),e=>(f(),b(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,null,{default:t(()=>[l(d,{type:"primary",onClick:_},{default:t(()=>[u(" 查询 ")]),_:1}),l(d,{onClick:a[3]||(a[3]=e=>re(r(Y)))},{default:t(()=>[u(" 重置 ")]),_:1})]),_:1}),N("span",Ae,[l(d,{type:"success",onClick:a[4]||(a[4]=e=>w.value=!0)},{default:t(()=>[u(" 添加Key "),l(I,{class:"ml-3"},{default:t(()=>[l(K)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),l(C,null,{default:t(()=>[l(z,{"show-icon":"",title:"KEY池说明",description:"所有key会按key绑定的模型自动划分为一般AI模型与增强AI模型、key余额耗尽将会自动锁定、每张key支持单独绑定模型与代理、已经上下文长度设置、如果不设置默认以全局配置为准！讯飞星火的apiKey为拼接值`${appId}.${apiKey}`",type:"success"})]),_:1}),l(C,{style:{width:"100%"}},{default:t(()=>[q((f(),b(pe,{border:"",data:r(J),style:{width:"100%"},size:"large"},{default:t(()=>[l(i,{prop:"key",label:"apiKey",width:"450"}),l(i,{prop:"secretKey",label:"secretKey",width:"320"}),l(i,{prop:"manufacturer",label:"厂商",width:"100"}),l(i,{prop:"model",align:"center",label:"绑定模型",width:"160"},{default:t(e=>[l($,{type:te.indexOf(e.row.model)>-1?"success":""},{default:t(()=>[u(y(e.row.model),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:t(e=>[l($,{type:r(be)[e.row.status]},{default:t(()=>[u(y(r(we)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"keyDetail.totalAmount",align:"center",label:"账户总额",width:"90"},{default:t(e=>[l(d,{type:"info",text:""},{default:t(()=>[u(y(e.row.keyDetail.totalAmount||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"keyDetail.useAmount",align:"center",label:"已用额度",width:"90"},{default:t(e=>[l(d,{type:"danger",text:""},{default:t(()=>[u(y(e.row.keyDetail.useAmount||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"keyDetail.balance",align:"center",label:"剩余额度",width:"90"},{default:t(e=>[l(d,{type:"success",text:""},{default:t(()=>[u(y(e.row.keyDetail.balance||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"keyDetail.expirDate",align:"center",label:"过期时间",width:"130"},{default:t(e=>[l(d,{type:"danger",text:""},{default:t(()=>[u(y(e.row.keyDetail.expirDate||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"weight",align:"center",label:"秘钥权重",width:"90"}),l(i,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),l(i,{prop:"keyStatus",align:"center",label:"key状态",width:"90"},{default:t(e=>[l($,{type:e.row.keyDetail.status===1?"success":"danger"},{default:t(()=>[u(y(e.row.keyDetail.status===1?"正常工作":e.row.keyDetail.status===-1?"查询失败":"已被封禁"),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"maxModelTokens",align:"center",label:"模型最大上下文",width:"140"},{default:t(e=>[l(d,{type:"info",text:""},{default:t(()=>[u(y(e.row.maxModelTokens||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"maxResponseTokens",align:"center",label:"最大回复支持Token",width:"160"},{default:t(e=>[l(d,{type:"info",text:""},{default:t(()=>[u(y(e.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"openaiProxyUrl",align:"center",label:"绑定的代理地址",width:"230"},{default:t(e=>[l(d,{type:"info",text:""},{default:t(()=>[u(y(e.row.openaiProxyUrl||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:t(e=>[u(y(r(_e)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(i,{fixed:"right",label:"操作",width:"200"},{default:t(e=>[l(d,{link:"",type:"primary",size:"small",onClick:ce=>se(e.row)},{default:t(()=>[u(" 变更 ")]),_:2},1032,["onClick"]),l(ie,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:ce=>ne(e.row)},{reference:t(()=>[l(d,{link:"",type:"danger",size:"small"},{default:t(()=>[u(" 删除秘钥 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[B,r(S)]]),l(fe,{class:"flex justify-end mt-5"},{default:t(()=>[l(me,{"current-page":c.page,"onUpdate:currentPage":a[5]||(a[5]=e=>c.page=e),"page-size":c.size,"onUpdate:pageSize":a[6]||(a[6]=e=>c.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:r(j),onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(W,{modelValue:r(w),"onUpdate:modelValue":a[19]||(a[19]=e=>Z(w)?w.value=e:null),"close-on-click-modal":!1,title:"批量添加秘钥",width:"670",onClose:a[20]||(a[20]=e=>F(r(L)))},{footer:t(()=>[N("span",De,[l(d,{onClick:a[17]||(a[17]=e=>w.value=!1)},{default:t(()=>[u("取消")]),_:1}),l(d,{type:"primary",onClick:a[18]||(a[18]=e=>ue(r(L)))},{default:t(()=>[u(y(r(Q)),1)]),_:1})])]),default:t(()=>[q((f(),b(M,{ref_key:"formPackageRef",ref:L,"label-position":"right","label-width":"120px",model:o,rules:ae},{default:t(()=>[l(s,{label:"模型厂商",prop:"manufacturer"},{default:t(()=>[l(x,{modelValue:o.manufacturer,"onUpdate:modelValue":a[7]||(a[7]=e=>o.manufacturer=e),filterable:"",clearable:"",placeholder:"请选择"},{default:t(()=>[(f(!0),D(R,null,P(ee,e=>(f(),b(g,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"绑定模型",prop:"model"},{default:t(()=>[l(x,{modelValue:o.model,"onUpdate:modelValue":a[8]||(a[8]=e=>o.model=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:t(()=>[(f(!0),D(R,null,P(le,e=>(f(),b(g,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"API key",prop:"key"},{default:t(()=>[l(m,{modelValue:o.key,"onUpdate:modelValue":a[9]||(a[9]=e=>o.key=e),placeholder:"请填写API key"},null,8,["modelValue"])]),_:1}),["baidu","xunfei"].indexOf(o.manufacturer.toLowerCase())>-1?(f(),b(s,{key:0,label:"Secret Key",prop:"key"},{default:t(()=>[l(m,{modelValue:o.secretKey,"onUpdate:modelValue":a[10]||(a[10]=e=>o.secretKey=e),placeholder:"请填写Secret key"},null,8,["modelValue"])]),_:1})):Ue("",!0),l(s,{label:"启用状态",prop:"status"},{default:t(()=>[l(ye,{modelValue:o.status,"onUpdate:modelValue":a[11]||(a[11]=e=>o.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(s,{label:"轮询权重",prop:"weight"},{default:t(()=>[l(m,{modelValue:o.weight,"onUpdate:modelValue":a[12]||(a[12]=e=>o.weight=e),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！"},null,8,["modelValue"])]),_:1}),l(s,{label:"模型最大Token",prop:"maxModelTokens"},{default:t(()=>[l(m,{modelValue:o.maxModelTokens,"onUpdate:modelValue":a[13]||(a[13]=e=>o.maxModelTokens=e),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])]),_:1}),l(s,{label:"最大回复Token",prop:"maxResponseTokens"},{default:t(()=>[l(m,{modelValue:o.maxResponseTokens,"onUpdate:modelValue":a[14]||(a[14]=e=>o.maxResponseTokens=e),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])]),_:1}),l(s,{label:"指定代理",prop:"openaiProxyUrl"},{default:t(()=>[l(m,{modelValue:o.openaiProxyUrl,"onUpdate:modelValue":a[15]||(a[15]=e=>o.openaiProxyUrl=e),modelModifiers:{number:!0},placeholder:"请填写key的指定代理、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1}),l(s,{label:"超时时间",prop:"openaiTimeoutMs"},{default:t(()=>[l(m,{modelValue:o.openaiTimeoutMs,"onUpdate:modelValue":a[16]||(a[16]=e=>o.openaiTimeoutMs=e),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（ms）、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[B,r(G)]])]),_:1},8,["modelValue"]),l(W,{modelValue:r(U),"onUpdate:modelValue":a[24]||(a[24]=e=>Z(U)?U.value=e:null),"close-on-click-modal":!1,title:r(oe),width:"670",onClose:a[25]||(a[25]=e=>F(r(L)))},{footer:t(()=>[N("span",Se,[l(d,{onClick:a[22]||(a[22]=e=>U.value=!1)},{default:t(()=>[u("取消")]),_:1}),l(d,{type:"primary",onClick:a[23]||(a[23]=e=>de(r(O)))},{default:t(()=>[u(y(r(Q)),1)]),_:1})])]),default:t(()=>[q((f(),b(M,{ref_key:"formBlukRef",ref:O,"label-position":"right","label-width":"120px",model:o},{default:t(()=>[l(s,{label:"key卡账号列表",prop:"keyList"},{default:t(()=>[l(m,{modelValue:h.keyList,"onUpdate:modelValue":a[21]||(a[21]=e=>h.keyList=e),type:"textarea",rows:8,placeholder:"请粘贴您的key秘钥列表、一行一个、批量添加的情况下我们将默认为您使用erniebot模型、并且不会检测秘钥的有效期、请您自行校验！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[B,r(G)]])]),_:1},8,["modelValue","title"])])}}});typeof E=="function"&&E(he);export{he as default};
